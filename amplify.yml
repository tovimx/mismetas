version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci --include=dev
        - npx prisma generate
        # Export secrets as environment variables
        - export AUTH_SECRET=${secrets.AUTH_SECRET}
        - export AUTH_GOOGLE_ID=${secrets.AUTH_GOOGLE_ID}
        - export AUTH_GOOGLE_SECRET=${secrets.AUTH_GOOGLE_SECRET}
        - export DATABASE_URL=${secrets.DATABASE_URL}
        # Verify secrets are set (without exposing values)
        - |
          echo "Verifying environment variables..."
          for var in AUTH_SECRET AUTH_GOOGLE_ID AUTH_GOOGLE_SECRET DATABASE_URL; do
            if [ -z "${!var}" ]; then
              echo "❌ $var is not set"
              exit 1
            else
              echo "✅ $var is set and not empty"
            fi
          done
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .next/cache/**/*
      - .npm/**/*
    appRoot: .
